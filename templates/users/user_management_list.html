{% extends 'base.html' %}

{% block title %}Quản lý User{% endblock %}

{% block content %}
    <h2>Quản lý User</h2>
    <p>Tìm kiếm và chỉnh sửa vai trò của tất cả user trong hệ thống.</p>

    <div class="search-form" style="margin-bottom: 20px;">
        <form method="GET" action="{% url 'user_management_list' %}">
            <input type="text" name="q" value="{{ search_query|default:'' }}" placeholder="Tìm theo Tên, Email, SĐT, CCCD..." style="width: 70%; display: inline-block;">
            <button type="submit" style="width: 25%; display: inline-block;">Tìm kiếm</button>
        </form>
    </div>

    <div class="user-table-container" style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background-color: var(--dark-grey); color: var(--white);">
                    <th style="padding: 10px;">Định danh (Email/SĐT/CCCD)</th>
                    <th style="padding: 10px;">Họ Tên</th>
                    <th style="padding: 10px;">Vai trò</th>
                    <th style="padding: 10px;">Là con của</th>
                    <th style="padding: 10px;">Hành động</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users_list %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px;">{{ u.email|default:u.phone_number|default:u.cccd }}</td>
                    <td style="padding: 10px;">{{ u.full_name|default:"(Chưa cập nhật)" }}</td>
                    <td style="padding: 10px;">
                        {% if u.is_staff %}
                            <span style="color: var(--primary-red); font-weight: bold;">Quản trị viên</span>
                        {% elif u.is_parent_user %}
                            <span style="color: #007bff; font-weight: bold;">User Cấp Cao</span>
                        {% else %}
                            User
                        {% endif %}
                    </td>
                    <td style="padding: 10px;">{{ u.parent|default:"--" }}</td>
                    <td style="padding: 10px;">
                        <a href="{% url 'user_management_edit' u.pk %}" class="btn" style="padding: 5px 10px; font-size: 0.9rem;">Chỉnh sửa</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="padding: 15px; text-align: center;">Không tìm thấy user nào.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}