{% extends 'base.html' %}

{% block title %}Quản lý Nhân Sự (Staff){% endblock %}

{% block content %}
    <h2 data-aos="fade-down">Quản lý Nhân Sự (Staff)</h2>

    <div class="dashboard-section" data-aos="fade-up">
        <h3>Thêm Staff Mới</h3>
        <p>Nhập email của user hiện có để gán quyền Staff.</p>
        <form method="POST" class="management-form">
            {% csrf_token %}
            {{ assign_form.as_p }}
            <button type="submit" class="btn">Gán Quyền Staff</button>
        </form>
    </div>

    <div class="dashboard-section" data-aos="fade-up" data-aos-delay="100">
        <h3>Danh sách Staff Hiện Tại</h3>
        <div class="table-responsive">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: var(--dark-grey); color: var(--white);">
                        <th style="padding: 10px; text-align: left;">Email</th>
                        <th style="padding: 10px; text-align: left;">Họ Tên</th>
                        <th style="padding: 10px; text-align: center;">Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    {% for staff_user in staff_list %}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px;">{{ staff_user.email }}</td>
                        <td style="padding: 10px;">{{ staff_user.full_name|default:"(Chưa cập nhật)" }}</td>
                        <td style="padding: 10px; text-align: center;">
                            {% if not staff_user.is_superuser %} {# Don't allow removing Superuser's staff status #}
                                {% if staff_user != request.user %} {# Don't allow removing own status #}
                                    <form method="POST" action="{% url 'staff_management_remove' staff_user.pk %}" style="display: inline;" onsubmit="return confirm('Bạn có chắc muốn xóa quyền Staff của user này?')">
                                        {% csrf_token %}
                                        <button type="submit" class="btn" style="background: #dc3545; padding: 5px 10px; font-size: 0.9rem;">Xóa Quyền Staff</button>
                                    </form>
                                {% else %}
                                    <span style="color: #6c757d; font-style: italic;">(Bạn)</span>
                                {% endif %}
                            {% else %}
                                <span style="color: var(--primary-red); font-weight: bold;">Superuser</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" style="padding: 15px; text-align: center;">Chưa có Staff nào.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
        <style> .table-responsive { overflow-x: auto; } @media (max-width: 768px) { .table-responsive table th, .table-responsive table td { white-space: nowrap; } } </style>
{% endblock %}